{% extends "ticket/base.html" %}
{% load static humanize %}

{% block title %}Thanh to√°n - DaNaGO{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/payment.css' %}">
{% endblock %}

{% block content %}

<!-- Config cho JS -->
<div id="payment-config"
     data-expires-at="{{ expires_at }}"
     data-status-url="{% url 'payment_status' order.ticket_code %}"
     data-my-tickets-url="{% url 'my_tickets' %}">
</div>

<div class="payment-container">
  <div class="payment-left">
      <h3>Thanh to√°n b·∫±ng VietQR</h3>
      <p>Vui l√≤ng qu√©t m√£ QR b·∫±ng ·ª©ng d·ª•ng ng√¢n h√†ng tr√™n ƒëi·ªán tho·∫°i c·ªßa b·∫°n.</p>
      <p>M√£ QR ch·ªâ c√≥ hi·ªáu l·ª±c <strong>5 ph√∫t</strong>.</p>

      <div class="qr-box">
          <!-- overlay che QR khi h·∫øt h·∫°n -->
          <div id="qr-expired-overlay" class="qr-expired-overlay">
              <div class="qr-overlay-content">
                  <h4>M√£ QR ƒë√£ h·∫øt hi·ªáu l·ª±c</h4>
                  <p>Vui l√≤ng quay l·∫°i trang ƒë·∫∑t v√© ƒë·ªÉ t·∫°o m√£ m·ªõi.</p>
                  <p class="qr-overlay-note">B·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn trang t·ª± ƒë·ªông trong 30 gi√¢y...</p>
              </div>
          </div>

          <img src="{{ qr_url }}" alt="VietQR">
          <div class="amount-text">
              T·ªïng ti·ªÅn: {{ total_amount|intcomma }} ƒë
          </div>
          <div class="countdown">
              Th·ªùi gian c√≤n l·∫°i: <span id="countdown">05:00</span>
          </div>
          <div id="status-box" class="status-box status-pending">
              ƒêang ch·ªù b·∫°n thanh to√°n...
          </div>
      </div>
  </div>

  <div class="payment-right">
      <h6 class="payment-right-title">Th√¥ng tin ƒë∆°n</h6>

      <div class="info-row">
          <span class="info-label">M√£ giao d·ªãch</span>
          <span class="info-value">{{ order.ticket_code }}</span>
      </div>

      <div class="info-row">
          <span class="info-label">Tuy·∫øn</span>
          <span class="info-value">
              {{ from_location }} ‚Üí {{ to_location }}
          </span>
      </div>

      <div class="info-row">
          <span class="info-label">Kh·ªüi h√†nh</span>
          <span class="info-value">{{ departure_str }}</span>
      </div>

      <div class="info-row">
          <span class="info-label">Gh·∫ø</span>
          <span class="info-value">{{ order.seats }}</span>
      </div>

      <div class="info-row info-row-total">
          <span class="info-label">S·ªë ti·ªÅn</span>
          <span class="info-value">{{ total_amount|intcomma }} ƒë</span>
      </div>

      <a href="javascript:history.back();" class="back-link">
          ‚Üê Quay l·∫°i ch·ªçn gh·∫ø
      </a>
  </div>
</div>

<!-- POPUP Thanh to√°n th√†nh c√¥ng -->
<div id="payment-success-modal" class="payment-success-modal" style="display:none;">
  <div class="payment-success-box">
      <h3>üéâ Thanh to√°n th√†nh c√¥ng!</h3>
      <p>B·∫°n ƒë√£ ƒë·∫∑t v√© th√†nh c√¥ng.</p>
      <p>B·∫°n c√≥ th·ªÉ xem chi ti·∫øt t·∫°i <strong>V√© c·ªßa t√¥i</strong>.</p>

      <div class="popup-actions">
          <button id="payment-success-view-btn" class="btn btn-success">
              Xem v√© c·ªßa t√¥i
          </button>
          <button id="payment-success-close-btn" class="btn btn-outline-secondary">
              ƒê√≥ng
          </button>
      </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/payment.js' %}"></script>
{% endblock %}
